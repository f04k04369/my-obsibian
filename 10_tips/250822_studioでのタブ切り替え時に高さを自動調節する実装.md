---
created: 2025-08-22
tags:
  - web制作
aliases:
  - Studio
reration:
---
```
/**
 * ===================================================================
 * 親要素の高さ調整スクリプト (タブ内アンカー対応版)
 * ===================================================================
 * 概要：
 * 従来のタブ切り替え機能に加え、特定のタブ内部にあるアンカーリンクへの
 * ナビゲーション機能を追加。別タブが表示されている場合でも、
 * 親タブに切り替えてから目的のアンカーまでスクロールする。
 */

(function() {
    'use-strict';

    // --- 設定 ---
    const CONFIG = {
        PARENT_ID: 'event-project-section',
        DEFAULT_TARGET_ID: 'event',
        TARGETS: {
            'project': {
                contentId: 'project',
                buttonIds: ['project-change-btn', 'project-btn-nav', 'project-btn-nav-mobile']
            },
            'event': {
                contentId: 'event',
                buttonIds: ['event-change-btn', 'event-btn-nav', 'event-btn-nav-mobile']
            }
        },
        // ▼▼▼【ここから追加】▼▼▼
        ANCHORS: {
            'event-video': {
                parentId: 'event', // このアンカーが属する親タブのID
                buttonIds: ['event-video-nav']
            }
        }
        // ▲▲▲【追加ここまで】▲▲▲
    };

    /**
     * 指定されたセクションを表示/スクロールし、高さを調整する
     * @param {string} targetIdToShow - 表示したいセクションのID
     * @param {boolean} shouldScroll - 表示後にその場所までスクロールするか
     */
    const updateView = (targetIdToShow, shouldScroll = false) => {
        const parentContainer = document.getElementById(CONFIG.PARENT_ID);
        if (!parentContainer) return;

        let targetElement = null;

        for (const id in CONFIG.TARGETS) {
            const contentElement = document.getElementById(CONFIG.TARGETS[id].contentId);
            if (contentElement) {
                if (id === targetIdToShow) {
                    contentElement.style.display = '';
                    targetElement = contentElement;
                } else {
                    contentElement.style.display = 'none';
                }
            }
        }

        if (targetElement) {
            setTimeout(() => {
                const newHeight = targetElement.offsetHeight;
                parentContainer.style.transition = 'height 0.4s ease';
                parentContainer.style.height = `${newHeight}px`;

                if (shouldScroll) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 50);
        }
    };
    
    // --- クリックイベントの監視 ---
    document.body.addEventListener('click', (event) => {
        const clickedLink = event.target.closest('a');
        if (!clickedLink) return;

        const clickedId = clickedLink.id;

        // まず、通常のタブ切り替えボタンかどうかをチェック
        for (const targetId in CONFIG.TARGETS) {
            if (CONFIG.TARGETS[targetId].buttonIds.includes(clickedId)) {
                event.preventDefault();
                updateView(targetId, true);
                return; // 処理完了
            }
        }

        // ▼▼▼【ここから追加】▼▼▼
        // 次に、タブ内アンカーへのボタンかどうかをチェック
        for (const anchorId in CONFIG.ANCHORS) {
            const anchorInfo = CONFIG.ANCHORS[anchorId];
            if (anchorInfo.buttonIds.includes(clickedId)) {
                event.preventDefault();

                // 1. まず親タブを表示する（スクロールはしない）
                updateView(anchorInfo.parentId, false);

                // 2. 親タブの高さ変更アニメーションが終わるのを待ってから、アンカーへスクロール
                setTimeout(() => {
                    const anchorElement = document.getElementById(anchorId);
                    if (anchorElement) {
                        anchorElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 400); // 親コンテナの高さ変更トランジション(0.4s)より少し待つ
                
                return; // 処理完了
            }
        }
        // ▲▲▲【追加ここまで】▲▲▲
    });

    // --- 初回読み込み時の初期状態設定 ---
    const initialize = () => {
        if (document.body.hasHeightAdjusterInitialized) return;

        const hash = window.location.hash.slice(1);
        let initialTargetId = CONFIG.DEFAULT_TARGET_ID;
        let scrollToAnchor = null;

        // URLハッシュがタブか、アンカーかを判断
        if (CONFIG.TARGETS[hash]) {
            initialTargetId = hash;
            scrollToAnchor = hash; // タブのトップへ
        } else if (CONFIG.ANCHORS[hash]) {
            initialTargetId = CONFIG.ANCHORS[hash].parentId;
            scrollToAnchor = hash; // 特定のアンカーへ
        }
        
        // 最初の表示（スクロールはさせない）
        updateView(initialTargetId, false);

        // スクロール対象があれば、少し待ってからスクロール
        if (scrollToAnchor) {
            setTimeout(() => {
                const elementToScroll = document.getElementById(scrollToAnchor);
                if(elementToScroll) {
                    elementToScroll.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 400);
        }

        document.body.hasHeightAdjusterInitialized = true;
    };
    
    // --- トリガー ---
    let initTimeout = null;
    const observer = new MutationObserver(() => {
        document.body.hasHeightAdjusterInitialized = false;
        clearTimeout(initTimeout);
        initTimeout = setTimeout(initialize, 100);
    });

    initialize();
    observer.observe(document.body, { childList: true });

    console.log("✅ [タブ内アンカー対応版] スクリプトが起動しました。");

})();
```